# ============================================================
# SPRING BOOT DEPLOY PIPELINE
# ------------------------------------------------------------
# This GitHub Actions workflow automates:
# 1. Pulls the latest Docker image from Docker Hub
# 2. Runs (or updates) the container on the target environment
# ============================================================
name: Spring Boot Deploy Pipeline

# ------------------------------------------------------------
# TRIGGERS
# - Runs when the build pipeline succeeds (on workflow_run)
# - OR manually via the workflow_dispatch event
# ------------------------------------------------------------

on:
  workflow_run:
    workflows: ["Spring Boot Build Pipeline"]
    types:
      - completed
  workflow_dispatch:                           # Manual trigger option
    inputs:
      image_tag:
        description: "Specify Docker image tag to deploy (optional)"
        required: false

jobs:
  deploy:
    name: Deploy Application
    runs-on: ubuntu-latest
    steps:
      # ------------------------------------------------------------
      # STEP 1: Log In to Docker Hub
      # ------------------------------------------------------------
      - name: Log in to DockerHub
        uses: docker/login-action@v4
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ env.DOCKER_HUB_USERNAME }}
          password: ${{ env.DOCKER_HUB_ACCESS_TOKEN }}

      # ------------------------------------------------------------
      # STEP 2: Pull the Docker Image
      # ------------------------------------------------------------
      - name: Pull Docker Image
        run: |
          echo "Pulling image from DockerHub: ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:${{ env.DEPLOY_TAG }}"
          docker pull ${{ env.DOCKER_HUB_USERNAME }}/${{ env.IMAGE_NAME }}:${{ env.DEPLOY_TAG }}
          echo "Image pulled successfully"